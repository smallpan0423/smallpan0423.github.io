<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>小潘的筆記</title>
  <style>
    body { margin:0; background-color:#DCB5FF; font-family:system-ui,-apple-system,"Noto Sans TC",sans-serif; }
    .center { text-align:center; margin: 1.5rem 0; }
    .downloads { max-width: 900px; margin: 0 auto; padding: 0 1rem; list-style: none; }
    .downloads li { margin: .6rem 0; }
    .updated { color:#444; opacity:.85; margin-left:.5rem; font-size:.95rem; }
    .filters.center { margin-top: .5rem; }
    .tag {
      display:inline-block; margin:.25rem; padding:.4rem .8rem; border-radius:999px;
      border:1px solid rgba(0,0,0,.15); background:#fff; cursor:pointer;
    }
    .tag.active { background:#6c5ce7; color:#fff; border-color:#6c5ce7; }
    .hidden { display:none !important; }
  </style>
</head>
<body>

  <h2 class="center">嗨我是小潘，歡迎來到我的個人網站，這裡可以找到關於我的物理學筆記、鋼琴樂譜、參考書</h2>

  <!-- 分類按鈕 -->
  <nav class="filters center" aria-label="檔案分類">
    <button class="tag active" data-cat="all">全部</button>
    <button class="tag" data-cat="em">四大力學筆記</button>
    <button class="tag" data-cat="math">數學筆記</button>
    <button class="tag" data-cat="thesis">畢業論文</button>
    <button class="tag" data-cat="misc">其他</button>
  </nav>

  <!-- 檔案清單 -->
  <ul class="downloads" id="fileList">
    <li data-folder="em">
      <a href="downloads/Classical-Electrodynamics.pdf" target="_blank" rel="noopener">
        《古典電磁學（更新中）》PDF
      </a>
      <span class="updated"
            data-repo-path="downloads/Classical-Electrodynamics.pdf"
            data-file="downloads/Classical-Electrodynamics.pdf">（更新查詢中…）</span>
    </li>

    <li data-folder="thesis">
      <a href="downloads/master.pdf" target="_blank" rel="noopener">
        《碩士論文》PDF
      </a>
      <span class="updated"
            data-repo-path="downloads/master.pdf"
            data-file="downloads/master.pdf">（更新查詢中…）</span>
    </li>
  </ul>



  
 <script>
  const GH_OWNER  = "smallpan0423";
  const GH_REPO   = "smallpan0423.github.io";
  const GH_BRANCH = "main"; // 若你的預設分支是 master 就改成 master

  const fmt = new Intl.DateTimeFormat('zh-TW', {
    dateStyle:'medium', timeStyle:'short', hour12:false, timeZone:'Asia/Taipei'
  });

  // 簡單快取（localStorage），避免每次開頁都打 API
  const CACHE_KEY   = 'gh_updates_cache_v1';
  const CACHE_TTLMS = 12 * 60 * 60 * 1000; // 12 小時
  let cache = {};
  try { cache = JSON.parse(localStorage.getItem(CACHE_KEY) || '{}'); } catch {}

  async function fetchCommitTime(repoPath) {
    const api = `https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/commits` +
                `?path=${encodeURIComponent(repoPath)}&per_page=1&sha=${encodeURIComponent(GH_BRANCH)}`;
    const res = await fetch(api, {
      headers: {
        'Accept': 'application/vnd.github+json',
        'X-GitHub-Api-Version': '2022-11-28'
      },
      cache: 'no-store'
    });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const arr = await res.json();
    if (!Array.isArray(arr) || arr.length === 0) throw new Error('EMPTY');
    const iso = arr[0].commit.committer?.date || arr[0].commit.author?.date;
    return new Date(iso);
  }

  async function getUpdatedDate(repoPath) {
    const now = Date.now();
    const rec = cache[repoPath];
    if (rec && (now - rec.t) < CACHE_TTLMS) return new Date(rec.iso);

    const d = await fetchCommitTime(repoPath);
    cache[repoPath] = { iso: d.toISOString(), t: now };
    localStorage.setItem(CACHE_KEY, JSON.stringify(cache));
    return d;
  }

  // 依序處理，避免同時太多請求
  (async () => {
    const els = [...document.querySelectorAll('.updated[data-repo-path]')];
    for (const el of els) {
      const path = el.dataset.repoPath; // 務必是 repo 內「真實路徑」，大小寫完全一致
      try {
        const d = await getUpdatedDate(path);
        el.textContent = `（更新：${fmt.format(d)}）`;
      } catch (e) {
        el.textContent = '（更新時間取得失敗）';
        console.warn('更新時間取得失敗：', path, e);
      }
      // 小延遲，更保險（可調整或拿掉）
      await new Promise(r => setTimeout(r, 150));
    }
  })();
</script>





</body>
</html>
